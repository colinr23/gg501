<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data/Analytic Critique | Spatial Knowledge Mobilization</title>
  <meta name="description" content="GG501 is the Spatial Knowedge Mobilization course as part of the Environmental Data Analytics field of specialization." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data/Analytic Critique | Spatial Knowledge Mobilization" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="GG501 is the Spatial Knowedge Mobilization course as part of the Environmental Data Analytics field of specialization." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data/Analytic Critique | Spatial Knowledge Mobilization" />
  
  <meta name="twitter:description" content="GG501 is the Spatial Knowedge Mobilization course as part of the Environmental Data Analytics field of specialization." />
  

<meta name="author" content="Colin Robertson" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dataanalytic-visualization.html"/>
<link rel="next" href="assignments.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">GG501</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#textbook"><i class="fa fa-check"></i><b>1.1</b> textbook</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.2</b> schedule</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#evaluation"><i class="fa fa-check"></i><b>1.3</b> evaluation</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#grading"><i class="fa fa-check"></i><b>1.3.1</b> grading</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#remote-access"><i class="fa fa-check"></i><b>1.4</b> remote access</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html"><i class="fa fa-check"></i><b>2</b> Data/Analytic Visualization</a>
<ul>
<li class="chapter" data-level="2.1" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#skm-introduction"><i class="fa fa-check"></i><b>2.1</b> SKM Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#intro-readings"><i class="fa fa-check"></i><b>2.1.1</b> Readings this week</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#tabular-data"><i class="fa fa-check"></i><b>2.2</b> Tabular Data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#tab-readings"><i class="fa fa-check"></i><b>2.2.1</b> Readings this week</a></li>
<li class="chapter" data-level="2.2.2" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#tab-case"><i class="fa fa-check"></i><b>2.2.2</b> Case Study</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#time-series-data"><i class="fa fa-check"></i><b>2.3</b> Time Series Data</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#time-readings"><i class="fa fa-check"></i><b>2.3.1</b> Readings this week</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#spatial-data"><i class="fa fa-check"></i><b>2.4</b> Spatial Data</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#space-readings"><i class="fa fa-check"></i><b>2.4.1</b> Readings this week</a></li>
<li class="chapter" data-level="2.4.2" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#space-case"><i class="fa fa-check"></i><b>2.4.2</b> Case Study</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#model-data"><i class="fa fa-check"></i><b>2.5</b> Model Data</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="dataanalytic-visualization.html"><a href="dataanalytic-visualization.html#model-readings"><i class="fa fa-check"></i><b>2.5.1</b> Resources this week</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dataanalytic-critique.html"><a href="dataanalytic-critique.html"><i class="fa fa-check"></i><b>3</b> Data/Analytic Critique</a>
<ul>
<li class="chapter" data-level="3.1" data-path="dataanalytic-critique.html"><a href="dataanalytic-critique.html#spatial-modelling-example---adapted-workshop-example"><i class="fa fa-check"></i><b>3.1</b> Spatial modelling example - adapted workshop example</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="dataanalytic-critique.html"><a href="dataanalytic-critique.html#modelcrit-readings"><i class="fa fa-check"></i><b>3.1.1</b> Resources this week</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="dataanalytic-critique.html"><a href="dataanalytic-critique.html#parameterizationvalidation-i"><i class="fa fa-check"></i><b>3.2</b> Parameterization/Validation I</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="assignments.html"><a href="assignments.html"><i class="fa fa-check"></i><b>4</b> Assignments</a>
<ul>
<li class="chapter" data-level="4.1" data-path="assignments.html"><a href="assignments.html#assignment-1---exploratory-visulization-in-ggplot"><i class="fa fa-check"></i><b>4.1</b> Assignment 1 - Exploratory Visulization in ggplot</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="assignments.html"><a href="assignments.html#questions"><i class="fa fa-check"></i><b>4.1.1</b> Questions</a></li>
<li class="chapter" data-level="4.1.2" data-path="assignments.html"><a href="assignments.html#submission"><i class="fa fa-check"></i><b>4.1.2</b> Submission</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="assignments.html"><a href="assignments.html#assignment-2---spatial-and-temporal-visualization-of-urban-data"><i class="fa fa-check"></i><b>4.2</b> Assignment 2 - Spatial and temporal visualization of urban data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="assignments.html"><a href="assignments.html#submission-1"><i class="fa fa-check"></i><b>4.2.1</b> Submission</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="assignments.html"><a href="assignments.html#assignment-3---tidy-tuesday-submission"><i class="fa fa-check"></i><b>4.3</b> Assignment 3 - Tidy Tuesday Submission</a></li>
<li class="chapter" data-level="4.4" data-path="assignments.html"><a href="assignments.html#term-project"><i class="fa fa-check"></i><b>4.4</b> Term Project</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Knowledge Mobilization</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dataanalytic-critique" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data/Analytic Critique</h1>
<p>The use of <code>modelling</code> is increasing as more data is produced and codified into machine-readable forms. From classical statistical models to modern machine learning frameworks, models make inferences about real world processes that rely on implicit and explicit assumptions and decisions. In order to work effectively with the outptus of models we must be able to explore these underlying factors and how they influence what models produce. As machine learning models in particular are encoded into complex data-analytic workflows, we need to develop skills for interrograting and deconstructing models, their paramaters and uncertainties, and their strengths and weaknesses. The next two weeks will focus on developing some skills for working with model output and exploring their fit in the context of <code>R</code>-based data science workflow, however similar tools exist and can be used in other languages and/or modelling environments.</p>
<div id="spatial-modelling-example---adapted-workshop-example" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Spatial modelling example - adapted workshop example</h2>
<p>The <a href="https://www.fs.fed.us/rm/ogden/research/Rworkshop/SampleData.shtml">data for this workshop</a> demo exists as multiple files and folders, so we have zipped them up and posted them to this github repo. Note that we have to use the <code>raw</code> link to get access to the actual data file not the page that shows the file, with that link we can follow the workflow we have used before to download, unzip and remove the zip file. Note that his zip file is large (~17 mb) so we probably only want to download it once.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="dataanalytic-critique.html#cb1-1" aria-hidden="true"></a><span class="co">#download.file(&quot;https://github.com/colinr23/gg501/blob/main/data/workshop_data.zip?raw=true&quot;, </span></span>
<span id="cb1-2"><a href="dataanalytic-critique.html#cb1-2" aria-hidden="true"></a><span class="co">#              destfile = &quot;workshop_data.zip&quot; , mode=&#39;wb&#39;)</span></span>
<span id="cb1-3"><a href="dataanalytic-critique.html#cb1-3" aria-hidden="true"></a><span class="co">#unzip(&quot;workshop_data.zip&quot;, exdir = &quot;.&quot;)</span></span>
<span id="cb1-4"><a href="dataanalytic-critique.html#cb1-4" aria-hidden="true"></a><span class="co">#file.remove(&quot;workshop_data.zip&quot;)</span></span></code></pre></div>
<p>Read in and examine the data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="dataanalytic-critique.html#cb2-1" aria-hidden="true"></a><span class="kw">library</span>(readr)</span>
<span id="cb2-2"><a href="dataanalytic-critique.html#cb2-2" aria-hidden="true"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb2-3"><a href="dataanalytic-critique.html#cb2-3" aria-hidden="true"></a><span class="kw">library</span>(tibble)</span>
<span id="cb2-4"><a href="dataanalytic-critique.html#cb2-4" aria-hidden="true"></a></span>
<span id="cb2-5"><a href="dataanalytic-critique.html#cb2-5" aria-hidden="true"></a><span class="kw">options</span>(<span class="dt">scipen=</span><span class="dv">6</span>)</span>
<span id="cb2-6"><a href="dataanalytic-critique.html#cb2-6" aria-hidden="true"></a>plt &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;workshop_data/SampleData_Basics/plt.csv&quot;</span>, </span>
<span id="cb2-7"><a href="dataanalytic-critique.html#cb2-7" aria-hidden="true"></a>                <span class="dt">col_types =</span> <span class="kw">list</span>(<span class="kw">col_character</span>(), <span class="kw">col_integer</span>(), </span>
<span id="cb2-8"><a href="dataanalytic-critique.html#cb2-8" aria-hidden="true"></a>                <span class="kw">col_integer</span>(), <span class="kw">col_integer</span>(), <span class="kw">col_integer</span>(), <span class="kw">col_double</span>(), </span>
<span id="cb2-9"><a href="dataanalytic-critique.html#cb2-9" aria-hidden="true"></a>                <span class="kw">col_double</span>(), <span class="kw">col_integer</span>(), <span class="kw">col_double</span>(), <span class="kw">col_double</span>(), </span>
<span id="cb2-10"><a href="dataanalytic-critique.html#cb2-10" aria-hidden="true"></a>                <span class="kw">col_character</span>(), <span class="kw">col_integer</span>()))</span>
<span id="cb2-11"><a href="dataanalytic-critique.html#cb2-11" aria-hidden="true"></a>tree &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;workshop_data/SampleData_Basics/tree.csv&quot;</span>, <span class="dt">col_types =</span> <span class="kw">list</span>(<span class="kw">col_character</span>()))</span>
<span id="cb2-12"><a href="dataanalytic-critique.html#cb2-12" aria-hidden="true"></a>ref &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;workshop_data/SampleData_Basics/ref_SPCD.csv&quot;</span>)</span>
<span id="cb2-13"><a href="dataanalytic-critique.html#cb2-13" aria-hidden="true"></a></span>
<span id="cb2-14"><a href="dataanalytic-critique.html#cb2-14" aria-hidden="true"></a>tree &lt;-<span class="st"> </span><span class="kw">left_join</span>(tree, ref, <span class="dt">by=</span><span class="st">&quot;SPCD&quot;</span>)</span>
<span id="cb2-15"><a href="dataanalytic-critique.html#cb2-15" aria-hidden="true"></a></span>
<span id="cb2-16"><a href="dataanalytic-critique.html#cb2-16" aria-hidden="true"></a>spfreq &lt;-<span class="st"> </span>tree <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(PLT_CN, SPNM)  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">table</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame.matrix</span>()  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(aspen) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;PLT_CN&quot;</span>)</span>
<span id="cb2-17"><a href="dataanalytic-critique.html#cb2-17" aria-hidden="true"></a><span class="co">#reset any counts greater than 1 to 1 --binary response</span></span>
<span id="cb2-18"><a href="dataanalytic-critique.html#cb2-18" aria-hidden="true"></a>spfreq<span class="op">$</span>aspen[spfreq<span class="op">$</span>aspen<span class="op">&gt;</span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb2-19"><a href="dataanalytic-critique.html#cb2-19" aria-hidden="true"></a>plt2 &lt;-<span class="st"> </span><span class="kw">left_join</span>(plt, spfreq, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;CN&quot;</span> =<span class="st"> &quot;PLT_CN&quot;</span>))</span></code></pre></div>
<p>Now we have created the <code>plt2</code> dataset at the plot level which contains plots where aspen is present or absent. We will keep working with the instructions from the workshop slides and modernize some of the workflow:</p>
<div class="figure">
<img src="img/response.png" alt="" />
<p class="caption">slide from workshop</p>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="dataanalytic-critique.html#cb3-1" aria-hidden="true"></a><span class="co">## Forest Inventory data (Model response)</span></span>
<span id="cb3-2"><a href="dataanalytic-critique.html#cb3-2" aria-hidden="true"></a><span class="co">## Now, let&#39;s compile total carbon by plot and append to plot table.</span></span>
<span id="cb3-3"><a href="dataanalytic-critique.html#cb3-3" aria-hidden="true"></a><span class="co"># First, create a table of counts by plot.</span></span>
<span id="cb3-4"><a href="dataanalytic-critique.html#cb3-4" aria-hidden="true"></a>plt2 &lt;-<span class="st"> </span>tree <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(PLT_CN) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-5"><a href="dataanalytic-critique.html#cb3-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">CARBON_AG =</span> <span class="kw">sum</span>(CARBON_AG)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-6"><a href="dataanalytic-critique.html#cb3-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">CARBON_KG =</span> <span class="kw">round</span>(CARBON_AG <span class="op">*</span><span class="st"> </span><span class="fl">0.453592</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-7"><a href="dataanalytic-critique.html#cb3-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">right_join</span>(plt2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;PLT_CN&quot;</span> =<span class="st"> &quot;CN&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-8"><a href="dataanalytic-critique.html#cb3-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">CARBON_KG=</span><span class="kw">replace</span>(CARBON_KG, <span class="kw">is.na</span>(CARBON_KG), <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-9"><a href="dataanalytic-critique.html#cb3-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">aspen=</span><span class="kw">replace</span>(aspen, <span class="kw">is.na</span>(aspen), <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-10"><a href="dataanalytic-critique.html#cb3-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">CARBON_AG =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<p>Now we can carry on with some of the spatial data processing to build the variables for modelling, a very common workflow</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="dataanalytic-critique.html#cb4-1" aria-hidden="true"></a><span class="co"># Load libraries</span></span>
<span id="cb4-2"><a href="dataanalytic-critique.html#cb4-2" aria-hidden="true"></a><span class="kw">library</span>(rgdal)  <span class="co"># GDAL operations for spatial data</span></span>
<span id="cb4-3"><a href="dataanalytic-critique.html#cb4-3" aria-hidden="true"></a><span class="kw">library</span>(raster) <span class="co"># Analyzing gridded spatial data</span></span>
<span id="cb4-4"><a href="dataanalytic-critique.html#cb4-4" aria-hidden="true"></a><span class="kw">library</span>(rpart)  <span class="co"># Recursive partitioning and regression trees</span></span>
<span id="cb4-5"><a href="dataanalytic-critique.html#cb4-5" aria-hidden="true"></a><span class="kw">library</span>(car)    <span class="co"># For book (An R Companion to Applied Regression)</span></span>
<span id="cb4-6"><a href="dataanalytic-critique.html#cb4-6" aria-hidden="true"></a><span class="kw">library</span>(randomForest)   <span class="co"># Generates Random Forest models</span></span>
<span id="cb4-7"><a href="dataanalytic-critique.html#cb4-7" aria-hidden="true"></a><span class="kw">library</span>(PresenceAbsence)    <span class="co"># Evaluates results of presence-absence models</span></span>
<span id="cb4-8"><a href="dataanalytic-critique.html#cb4-8" aria-hidden="true"></a><span class="kw">library</span>(ModelMap)   <span class="co"># Generates and applies Random Forest models</span></span>
<span id="cb4-9"><a href="dataanalytic-critique.html#cb4-9" aria-hidden="true"></a></span>
<span id="cb4-10"><a href="dataanalytic-critique.html#cb4-10" aria-hidden="true"></a><span class="co"># We need to extract data from spatial layers, so let&#39;s convert the plot table to a SpatialPoints object in R.</span></span>
<span id="cb4-11"><a href="dataanalytic-critique.html#cb4-11" aria-hidden="true"></a><span class="co">## We know the projection information, so we can add it to the SpatialPoints object. </span></span>
<span id="cb4-12"><a href="dataanalytic-critique.html#cb4-12" aria-hidden="true"></a>prj4str &lt;-<span class="st"> &quot;+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs&quot;</span></span>
<span id="cb4-13"><a href="dataanalytic-critique.html#cb4-13" aria-hidden="true"></a>ptshp &lt;-<span class="st"> </span><span class="kw">SpatialPointsDataFrame</span>(plt[,<span class="kw">c</span>(<span class="st">&quot;LON&quot;</span>,<span class="st">&quot;LAT&quot;</span>)], plt,      <span class="dt">proj4string =</span> <span class="kw">CRS</span>(prj4str))</span>
<span id="cb4-14"><a href="dataanalytic-critique.html#cb4-14" aria-hidden="true"></a><span class="co">## Display the points</span></span>
<span id="cb4-15"><a href="dataanalytic-critique.html#cb4-15" aria-hidden="true"></a><span class="kw">plot</span>(ptshp)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="dataanalytic-critique.html#cb5-1" aria-hidden="true"></a><span class="co">## Predictor variables:</span></span>
<span id="cb5-2"><a href="dataanalytic-critique.html#cb5-2" aria-hidden="true"></a>    <span class="co"># Landsat Thematic Mapper, band 5   30-m spectral data, band 5, resampled to 90 m</span></span>
<span id="cb5-3"><a href="dataanalytic-critique.html#cb5-3" aria-hidden="true"></a>    <span class="co"># Landsat Thematic Mapper, NDVI 30-m spectral data, NDVI, resampled to 90 m</span></span>
<span id="cb5-4"><a href="dataanalytic-critique.html#cb5-4" aria-hidden="true"></a>    <span class="co"># Classified forest/nonforest map       250-m classified MODIS, resampled to 90 m</span></span>
<span id="cb5-5"><a href="dataanalytic-critique.html#cb5-5" aria-hidden="true"></a>    <span class="co"># Elevation             30-m DEM, resampled to 90 m</span></span>
<span id="cb5-6"><a href="dataanalytic-critique.html#cb5-6" aria-hidden="true"></a>    <span class="co"># Slope                 90-m DEM – derived in a following slides</span></span>
<span id="cb5-7"><a href="dataanalytic-critique.html#cb5-7" aria-hidden="true"></a>  <span class="co"># Aspect  </span></span>
<span id="cb5-8"><a href="dataanalytic-critique.html#cb5-8" aria-hidden="true"></a><span class="co">## Set file names</span></span>
<span id="cb5-9"><a href="dataanalytic-critique.html#cb5-9" aria-hidden="true"></a>b5fn &lt;-<span class="st"> &quot;workshop_data/SampleData_Spatial/uintaN_TMB5.img&quot;</span>      <span class="co"># Landsat TM–Band5</span></span>
<span id="cb5-10"><a href="dataanalytic-critique.html#cb5-10" aria-hidden="true"></a>ndvifn &lt;-<span class="st"> &quot;workshop_data/SampleData_Spatial/uintaN_TMndvi.img&quot;</span>      <span class="co"># Landsat TM–NDVI</span></span>
<span id="cb5-11"><a href="dataanalytic-critique.html#cb5-11" aria-hidden="true"></a>fnffn &lt;-<span class="st"> &quot;workshop_data/SampleData_Spatial/uintaN_fnfrcl.img&quot;</span>       <span class="co"># Forest type map (reclassed)</span></span>
<span id="cb5-12"><a href="dataanalytic-critique.html#cb5-12" aria-hidden="true"></a>elevfn &lt;-<span class="st"> &quot;workshop_data/SampleData_Spatial/uintaN_elevm.img&quot;</span>       <span class="co"># Elevation (meters)</span></span>
<span id="cb5-13"><a href="dataanalytic-critique.html#cb5-13" aria-hidden="true"></a></span>
<span id="cb5-14"><a href="dataanalytic-critique.html#cb5-14" aria-hidden="true"></a><span class="co">## Reclass raster layer to 2 categories</span></span>
<span id="cb5-15"><a href="dataanalytic-critique.html#cb5-15" aria-hidden="true"></a>fnf &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;workshop_data/SampleData_Spatial/uintaN_fnf.img&quot;</span>)</span>
<span id="cb5-16"><a href="dataanalytic-critique.html#cb5-16" aria-hidden="true"></a></span>
<span id="cb5-17"><a href="dataanalytic-critique.html#cb5-17" aria-hidden="true"></a><span class="co">## Create raster look-up table</span></span>
<span id="cb5-18"><a href="dataanalytic-critique.html#cb5-18" aria-hidden="true"></a>fromvect &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)</span>
<span id="cb5-19"><a href="dataanalytic-critique.html#cb5-19" aria-hidden="true"></a>tovect &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb5-20"><a href="dataanalytic-critique.html#cb5-20" aria-hidden="true"></a>rclmat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(fromvect, tovect), <span class="dv">4</span>, <span class="dv">2</span>)</span>
<span id="cb5-21"><a href="dataanalytic-critique.html#cb5-21" aria-hidden="true"></a><span class="co">## Generate raster and save to SpatialData folder</span></span>
<span id="cb5-22"><a href="dataanalytic-critique.html#cb5-22" aria-hidden="true"></a>fnfrcl &lt;-<span class="st"> </span><span class="kw">reclassify</span>(<span class="dt">x=</span>fnf, rclmat, <span class="dt">datatype=</span><span class="st">&#39;INT2U&#39;</span>, <span class="dt">filename=</span><span class="st">&quot;workshop_data/SampleData_Spatial/uintaN_fnfrcl.img&quot;</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</span>
<span id="cb5-23"><a href="dataanalytic-critique.html#cb5-23" aria-hidden="true"></a></span>
<span id="cb5-24"><a href="dataanalytic-critique.html#cb5-24" aria-hidden="true"></a><span class="co">## Check rasters</span></span>
<span id="cb5-25"><a href="dataanalytic-critique.html#cb5-25" aria-hidden="true"></a>rastfnlst &lt;-<span class="st"> </span><span class="kw">c</span>(b5fn, ndvifn, fnffn, elevfn)</span>
<span id="cb5-26"><a href="dataanalytic-critique.html#cb5-26" aria-hidden="true"></a>rastfnlst</span></code></pre></div>
<pre><code>## [1] &quot;workshop_data/SampleData_Spatial/uintaN_TMB5.img&quot;  
## [2] &quot;workshop_data/SampleData_Spatial/uintaN_TMndvi.img&quot;
## [3] &quot;workshop_data/SampleData_Spatial/uintaN_fnfrcl.img&quot;
## [4] &quot;workshop_data/SampleData_Spatial/uintaN_elevm.img&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="dataanalytic-critique.html#cb7-1" aria-hidden="true"></a><span class="kw">sapply</span>(rastfnlst, raster)</span></code></pre></div>
<pre><code>## $`workshop_data/SampleData_Spatial/uintaN_TMB5.img`
## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : /Users/colinr23/Dropbox/course/g501/tec/gg501/workshop_data/SampleData_Spatial/uintaN_TMb5.img 
## names      : uintaN_TMb5 
## values     : 1, 255  (min, max)
## 
## 
## $`workshop_data/SampleData_Spatial/uintaN_TMndvi.img`
## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : /Users/colinr23/Dropbox/course/g501/tec/gg501/workshop_data/SampleData_Spatial/uintaN_TMndvi.img 
## names      : uintaN_TMndvi 
## values     : 0, 193  (min, max)
## 
## 
## $`workshop_data/SampleData_Spatial/uintaN_fnfrcl.img`
## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : /Users/colinr23/Dropbox/course/g501/tec/gg501/workshop_data/SampleData_Spatial/uintaN_fnfrcl.img 
## names      : uintaN_fnfrcl 
## values     : 1, 2  (min, max)
## 
## 
## $`workshop_data/SampleData_Spatial/uintaN_elevm.img`
## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : /Users/colinr23/Dropbox/course/g501/tec/gg501/workshop_data/SampleData_Spatial/uintaN_elevm.img 
## names      : uintaN_elevm 
## values     : 1847, 4114  (min, max)</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="dataanalytic-critique.html#cb9-1" aria-hidden="true"></a><span class="co">## Now, let&#39;s generate slope from DEM. Save it to your workshop_data/SampleData_Spatial folder.</span></span>
<span id="cb9-2"><a href="dataanalytic-critique.html#cb9-2" aria-hidden="true"></a><span class="kw">help</span>(terrain)</span>
<span id="cb9-3"><a href="dataanalytic-critique.html#cb9-3" aria-hidden="true"></a><span class="kw">help</span>(writeRaster)</span>
<span id="cb9-4"><a href="dataanalytic-critique.html#cb9-4" aria-hidden="true"></a></span>
<span id="cb9-5"><a href="dataanalytic-critique.html#cb9-5" aria-hidden="true"></a>slpfn &lt;-<span class="st"> &quot;workshop_data/SampleData_Spatial/uintaN_slp.img&quot;</span> </span>
<span id="cb9-6"><a href="dataanalytic-critique.html#cb9-6" aria-hidden="true"></a>slope &lt;-<span class="st"> </span><span class="kw">terrain</span>(<span class="kw">raster</span>(elevfn), <span class="dt">opt=</span><span class="kw">c</span>(<span class="st">&#39;slope&#39;</span>), <span class="dt">unit=</span><span class="st">&#39;degrees&#39;</span>,    <span class="dt">filename=</span>slpfn, <span class="dt">datatype=</span><span class="st">&#39;INT1U&#39;</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</span>
<span id="cb9-7"><a href="dataanalytic-critique.html#cb9-7" aria-hidden="true"></a><span class="co">####************* this may take some time ****************  </span></span>
<span id="cb9-8"><a href="dataanalytic-critique.html#cb9-8" aria-hidden="true"></a><span class="kw">plot</span>(slope, <span class="dt">col=</span><span class="kw">topo.colors</span>(<span class="dv">6</span>))</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="dataanalytic-critique.html#cb10-1" aria-hidden="true"></a><span class="co">####************* this may take some time ****************</span></span>
<span id="cb10-2"><a href="dataanalytic-critique.html#cb10-2" aria-hidden="true"></a></span>
<span id="cb10-3"><a href="dataanalytic-critique.html#cb10-3" aria-hidden="true"></a></span>
<span id="cb10-4"><a href="dataanalytic-critique.html#cb10-4" aria-hidden="true"></a><span class="co">## Check rasters</span></span>
<span id="cb10-5"><a href="dataanalytic-critique.html#cb10-5" aria-hidden="true"></a>rastfnlst &lt;-<span class="st"> </span><span class="kw">c</span>(b5fn, ndvifn, fnffn, elevfn, slpfn)</span>
<span id="cb10-6"><a href="dataanalytic-critique.html#cb10-6" aria-hidden="true"></a>rastfnlst</span></code></pre></div>
<pre><code>## [1] &quot;workshop_data/SampleData_Spatial/uintaN_TMB5.img&quot;  
## [2] &quot;workshop_data/SampleData_Spatial/uintaN_TMndvi.img&quot;
## [3] &quot;workshop_data/SampleData_Spatial/uintaN_fnfrcl.img&quot;
## [4] &quot;workshop_data/SampleData_Spatial/uintaN_elevm.img&quot; 
## [5] &quot;workshop_data/SampleData_Spatial/uintaN_slp.img&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="dataanalytic-critique.html#cb12-1" aria-hidden="true"></a><span class="kw">sapply</span>(rastfnlst, raster)</span></code></pre></div>
<pre><code>## $`workshop_data/SampleData_Spatial/uintaN_TMB5.img`
## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : /Users/colinr23/Dropbox/course/g501/tec/gg501/workshop_data/SampleData_Spatial/uintaN_TMb5.img 
## names      : uintaN_TMb5 
## values     : 1, 255  (min, max)
## 
## 
## $`workshop_data/SampleData_Spatial/uintaN_TMndvi.img`
## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : /Users/colinr23/Dropbox/course/g501/tec/gg501/workshop_data/SampleData_Spatial/uintaN_TMndvi.img 
## names      : uintaN_TMndvi 
## values     : 0, 193  (min, max)
## 
## 
## $`workshop_data/SampleData_Spatial/uintaN_fnfrcl.img`
## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : /Users/colinr23/Dropbox/course/g501/tec/gg501/workshop_data/SampleData_Spatial/uintaN_fnfrcl.img 
## names      : uintaN_fnfrcl 
## values     : 1, 2  (min, max)
## 
## 
## $`workshop_data/SampleData_Spatial/uintaN_elevm.img`
## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : /Users/colinr23/Dropbox/course/g501/tec/gg501/workshop_data/SampleData_Spatial/uintaN_elevm.img 
## names      : uintaN_elevm 
## values     : 1847, 4114  (min, max)
## 
## 
## $`workshop_data/SampleData_Spatial/uintaN_slp.img`
## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : /Users/colinr23/Dropbox/course/g501/tec/gg501/workshop_data/SampleData_Spatial/uintaN_slp.img 
## names      : uintaN_slp 
## values     : 0, 77  (min, max)</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="dataanalytic-critique.html#cb14-1" aria-hidden="true"></a><span class="co">## We can also generate aspect from DEM. Save it to your workshop_data/SampleData_Spatial folder.</span></span>
<span id="cb14-2"><a href="dataanalytic-critique.html#cb14-2" aria-hidden="true"></a><span class="kw">help</span>(terrain)</span>
<span id="cb14-3"><a href="dataanalytic-critique.html#cb14-3" aria-hidden="true"></a></span>
<span id="cb14-4"><a href="dataanalytic-critique.html#cb14-4" aria-hidden="true"></a><span class="co">## This is an intermediate step, so we are not going to save it.</span></span>
<span id="cb14-5"><a href="dataanalytic-critique.html#cb14-5" aria-hidden="true"></a>aspectr &lt;-<span class="st"> </span><span class="kw">terrain</span>(<span class="kw">raster</span>(elevfn), <span class="dt">opt=</span><span class="kw">c</span>(<span class="st">&#39;aspect&#39;</span>), <span class="dt">unit=</span><span class="st">&#39;radians&#39;</span>)</span>
<span id="cb14-6"><a href="dataanalytic-critique.html#cb14-6" aria-hidden="true"></a>aspectr</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : memory
## names      : aspect 
## values     : 0, 6.283185  (min, max)</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="dataanalytic-critique.html#cb16-1" aria-hidden="true"></a><span class="co"># Note: Make sure to use radians, not degrees</span></span>
<span id="cb16-2"><a href="dataanalytic-critique.html#cb16-2" aria-hidden="true"></a><span class="co">####************* this may take some time ****************</span></span>
<span id="cb16-3"><a href="dataanalytic-critique.html#cb16-3" aria-hidden="true"></a><span class="kw">plot</span>(aspectr, <span class="dt">col=</span><span class="kw">terrain.colors</span>(<span class="dv">6</span>))</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-8-3.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="dataanalytic-critique.html#cb17-1" aria-hidden="true"></a><span class="co">## Aspect is a circular variable. There are a couple ways to deal with this:</span></span>
<span id="cb17-2"><a href="dataanalytic-critique.html#cb17-2" aria-hidden="true"></a></span>
<span id="cb17-3"><a href="dataanalytic-critique.html#cb17-3" aria-hidden="true"></a><span class="co">## 1. Convert the values to a categorical variable (ex. North, South, West, East)</span></span>
<span id="cb17-4"><a href="dataanalytic-critique.html#cb17-4" aria-hidden="true"></a></span>
<span id="cb17-5"><a href="dataanalytic-critique.html#cb17-5" aria-hidden="true"></a><span class="co">## We derived aspect in radians. First convert radians to degrees.</span></span>
<span id="cb17-6"><a href="dataanalytic-critique.html#cb17-6" aria-hidden="true"></a>aspectd &lt;-<span class="st"> </span><span class="kw">round</span>(aspectr <span class="op">*</span><span class="st"> </span><span class="dv">180</span><span class="op">/</span>pi)</span>
<span id="cb17-7"><a href="dataanalytic-critique.html#cb17-7" aria-hidden="true"></a>aspectd</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : memory
## names      : layer 
## values     : 0, 360  (min, max)</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="dataanalytic-critique.html#cb19-1" aria-hidden="true"></a><span class="co">## Now, create a look-up table of reclass values.</span></span>
<span id="cb19-2"><a href="dataanalytic-critique.html#cb19-2" aria-hidden="true"></a><span class="kw">help</span>(reclassify)</span>
<span id="cb19-3"><a href="dataanalytic-critique.html#cb19-3" aria-hidden="true"></a>frommat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">45</span>, <span class="dv">45</span>,<span class="dv">135</span>, <span class="dv">135</span>,<span class="dv">225</span>, <span class="dv">225</span>,<span class="dv">315</span>, <span class="dv">315</span>,<span class="dv">361</span>), <span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb19-4"><a href="dataanalytic-critique.html#cb19-4" aria-hidden="true"></a>frommat</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    0  225
## [2,]   45  225
## [3,]   45  315
## [4,]  135  315
## [5,]  135  361</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="dataanalytic-critique.html#cb21-1" aria-hidden="true"></a>frommat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">45</span>, <span class="dv">45</span>,<span class="dv">135</span>, <span class="dv">135</span>,<span class="dv">225</span>, <span class="dv">225</span>,<span class="dv">315</span>, <span class="dv">315</span>,<span class="dv">361</span>), <span class="dv">5</span>, <span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</span>
<span id="cb21-2"><a href="dataanalytic-critique.html#cb21-2" aria-hidden="true"></a>frommat</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    0   45
## [2,]   45  135
## [3,]  135  225
## [4,]  225  315
## [5,]  315  361</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="dataanalytic-critique.html#cb23-1" aria-hidden="true"></a>tovect &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb23-2"><a href="dataanalytic-critique.html#cb23-2" aria-hidden="true"></a></span>
<span id="cb23-3"><a href="dataanalytic-critique.html#cb23-3" aria-hidden="true"></a>rclmat &lt;-<span class="st"> </span><span class="kw">cbind</span>(frommat, tovect)</span>
<span id="cb23-4"><a href="dataanalytic-critique.html#cb23-4" aria-hidden="true"></a>rclmat</span></code></pre></div>
<pre><code>##              tovect
## [1,]   0  45      1
## [2,]  45 135      2
## [3,] 135 225      3
## [4,] 225 315      4
## [5,] 315 361      1</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="dataanalytic-critique.html#cb25-1" aria-hidden="true"></a><span class="co">## Reclassify raster to new values.</span></span>
<span id="cb25-2"><a href="dataanalytic-critique.html#cb25-2" aria-hidden="true"></a>aspcl &lt;-<span class="st"> </span><span class="kw">reclassify</span>(<span class="dt">x=</span>aspectd, rclmat, <span class="dt">include.lowest=</span><span class="ot">TRUE</span>)</span>
<span id="cb25-3"><a href="dataanalytic-critique.html#cb25-3" aria-hidden="true"></a>aspcl</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : memory
## names      : layer 
## values     : 1, 4  (min, max)</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="dataanalytic-critique.html#cb27-1" aria-hidden="true"></a><span class="kw">unique</span>(aspcl)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="dataanalytic-critique.html#cb29-1" aria-hidden="true"></a>bks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">sort</span>(<span class="kw">unique</span>(aspcl))) <span class="co"># Break points</span></span>
<span id="cb29-2"><a href="dataanalytic-critique.html#cb29-2" aria-hidden="true"></a>cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dark green&quot;</span>, <span class="st">&quot;wheat&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;blue&quot;</span>)  <span class="co"># Colors</span></span>
<span id="cb29-3"><a href="dataanalytic-critique.html#cb29-3" aria-hidden="true"></a>labs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;North&quot;</span>, <span class="st">&quot;East&quot;</span>, <span class="st">&quot;South&quot;</span>, <span class="st">&quot;West&quot;</span>) <span class="co"># Labels</span></span>
<span id="cb29-4"><a href="dataanalytic-critique.html#cb29-4" aria-hidden="true"></a>lab.pts &lt;-<span class="st"> </span>bks[<span class="op">-</span><span class="dv">1</span>]<span class="op">-</span><span class="kw">diff</span>(bks)<span class="op">/</span><span class="dv">2</span>  <span class="co"># Label position</span></span>
<span id="cb29-5"><a href="dataanalytic-critique.html#cb29-5" aria-hidden="true"></a><span class="co">####************* this may take some time ****************</span></span>
<span id="cb29-6"><a href="dataanalytic-critique.html#cb29-6" aria-hidden="true"></a><span class="kw">plot</span>(aspcl, <span class="dt">col=</span>cols, <span class="dt">axis.args=</span><span class="kw">list</span>(<span class="dt">at=</span>lab.pts, <span class="dt">labels=</span>labs), <span class="dt">breaks=</span>bks)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-8-4.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="dataanalytic-critique.html#cb30-1" aria-hidden="true"></a><span class="co">## 2. Convert to a linear variable (ex. solar radiation index; Roberts and Cooper 1989)</span></span>
<span id="cb30-2"><a href="dataanalytic-critique.html#cb30-2" aria-hidden="true"></a></span>
<span id="cb30-3"><a href="dataanalytic-critique.html#cb30-3" aria-hidden="true"></a>aspval &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">cos</span>(aspectr<span class="op">+</span><span class="dv">30</span>))<span class="op">/</span><span class="dv">2</span>   <span class="co">## Roberts and Cooper 1989</span></span>
<span id="cb30-4"><a href="dataanalytic-critique.html#cb30-4" aria-hidden="true"></a>aspval</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : memory
## names      : layer 
## values     : 7.793766e-13, 1  (min, max)</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="dataanalytic-critique.html#cb32-1" aria-hidden="true"></a><span class="kw">plot</span>(aspval)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-8-5.png" width="672" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="dataanalytic-critique.html#cb33-1" aria-hidden="true"></a><span class="co">## Let&#39;s multiply by 100 and round so it will be an integer (less memory)</span></span>
<span id="cb33-2"><a href="dataanalytic-critique.html#cb33-2" aria-hidden="true"></a>aspval &lt;-<span class="st"> </span><span class="kw">round</span>(aspval <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)</span>
<span id="cb33-3"><a href="dataanalytic-critique.html#cb33-3" aria-hidden="true"></a>aspval</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 2080, 4358, 9064640  (nrow, ncol, ncell)
## resolution : 30, 30  (x, y)
## extent     : 481612.1, 612352.1, 4477098, 4539498  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs 
## source     : memory
## names      : layer 
## values     : 0, 100  (min, max)</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="dataanalytic-critique.html#cb35-1" aria-hidden="true"></a><span class="kw">plot</span>(aspval)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-8-6.png" width="672" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="dataanalytic-critique.html#cb36-1" aria-hidden="true"></a><span class="co"># Save this layer to file</span></span>
<span id="cb36-2"><a href="dataanalytic-critique.html#cb36-2" aria-hidden="true"></a>aspvalfn &lt;-<span class="st"> &quot;workshop_data/SampleData_Spatial/uintaN_aspval.img&quot;</span></span>
<span id="cb36-3"><a href="dataanalytic-critique.html#cb36-3" aria-hidden="true"></a><span class="kw">writeRaster</span>(aspval, <span class="dt">filename=</span>aspvalfn, <span class="dt">datatype=</span><span class="st">&#39;INT1U&#39;</span>, <span class="dt">overwrite=</span><span class="ot">TRUE</span>)</span>
<span id="cb36-4"><a href="dataanalytic-critique.html#cb36-4" aria-hidden="true"></a></span>
<span id="cb36-5"><a href="dataanalytic-critique.html#cb36-5" aria-hidden="true"></a><span class="co"># Add aspval to rastfnlst</span></span>
<span id="cb36-6"><a href="dataanalytic-critique.html#cb36-6" aria-hidden="true"></a>rastfnlst &lt;-<span class="st"> </span><span class="kw">c</span>(rastfnlst, aspvalfn)</span>
<span id="cb36-7"><a href="dataanalytic-critique.html#cb36-7" aria-hidden="true"></a></span>
<span id="cb36-8"><a href="dataanalytic-critique.html#cb36-8" aria-hidden="true"></a><span class="co">## Converts aspect into solar radiation equivalents, with a correction of 30 degrees to reflect ## the relative heat of the atmosphere at the time the peak radiation is received. </span></span>
<span id="cb36-9"><a href="dataanalytic-critique.html#cb36-9" aria-hidden="true"></a><span class="co">## Max value is 1.0, occurring at 30 degrees aspect; min value is 0, at 210 degrees aspect. </span></span>
<span id="cb36-10"><a href="dataanalytic-critique.html#cb36-10" aria-hidden="true"></a></span>
<span id="cb36-11"><a href="dataanalytic-critique.html#cb36-11" aria-hidden="true"></a><span class="co">#Roberts, D.W., and S. V. Cooper. 1989. Concepts and techniques in vegetation mapping. In Land classifications based on vegetation: applications for resource management. D. Ferguson, P. Morgan, and F. D. Johnson, editors. USDA Forest Service General Technical Report INT-257, Ogden, Utah, USA.</span></span></code></pre></div>
<p><strong>Predictor Data Extraction</strong>
<img src="img/extraction.png" alt="slide from workshop" />
One of the most common uses of GIS and spatial processing functions in <code>r</code> is to build spatial variables which are then used for modelling. Here we have some data at specific coordinates where field plots were located, and we have several raster layers where we have environmental covariates. We want to extract values of raster layers at the locations of the point data.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="dataanalytic-critique.html#cb37-1" aria-hidden="true"></a><span class="co">## We need to check the projections of the rasters. If the projections are different,</span></span>
<span id="cb37-2"><a href="dataanalytic-critique.html#cb37-2" aria-hidden="true"></a><span class="co">## reproject the points to the projection of the rasters, it is much faster.</span></span>
<span id="cb37-3"><a href="dataanalytic-critique.html#cb37-3" aria-hidden="true"></a></span>
<span id="cb37-4"><a href="dataanalytic-critique.html#cb37-4" aria-hidden="true"></a><span class="co">## We will use the plt2 table with LON/LAT coordinates and the response data attached.</span></span>
<span id="cb37-5"><a href="dataanalytic-critique.html#cb37-5" aria-hidden="true"></a><span class="kw">head</span>(plt2)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   PLT_CN      CARBON_KG INVYR STATECD COUNTYCD  PLOT   LON   LAT NBRCND CRCOVPLT
##   &lt;chr&gt;           &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;    &lt;dbl&gt;
## 1 1193966501…      1840  2006      49        9 80275 -110.  40.9      1       50
## 2 1194012301…      5069  2006      49       13 80402 -110.  40.6      1       43
## 3 1194018001…      1416  2006      49       13 80936 -111.  40.6      1       28
## 4 1194028701…      1336  2006      49       13 82102 -110.  40.7      1       39
## 5 1194041401…      6512  2006      49       13 83586 -111.  40.6      1       38
## 6 1194050001…      3295  2006      49       13 83925 -110.  40.6      1       27
## # … with 4 more variables: CCLIVEPLT &lt;dbl&gt;, FORNONSAMP &lt;chr&gt;, ELEVM &lt;int&gt;,
## #   aspen &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="dataanalytic-critique.html#cb39-1" aria-hidden="true"></a><span class="co">## We know the LON/LAT coordinates have the following projection:</span></span>
<span id="cb39-2"><a href="dataanalytic-critique.html#cb39-2" aria-hidden="true"></a>prj4str &lt;-<span class="st"> &quot;+proj=longlat +ellps=GRS80 +datum=NAD83 +no_defs&quot;</span></span>
<span id="cb39-3"><a href="dataanalytic-critique.html#cb39-3" aria-hidden="true"></a></span>
<span id="cb39-4"><a href="dataanalytic-critique.html#cb39-4" aria-hidden="true"></a><span class="co"># Check projections of each raster..  </span></span>
<span id="cb39-5"><a href="dataanalytic-critique.html#cb39-5" aria-hidden="true"></a><span class="kw">sapply</span>(rastfnlst, <span class="cf">function</span>(x){ <span class="kw">projection</span>(<span class="kw">raster</span>(x)) })</span></code></pre></div>
<pre><code>##    workshop_data/SampleData_Spatial/uintaN_TMB5.img 
## &quot;+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs&quot; 
##  workshop_data/SampleData_Spatial/uintaN_TMndvi.img 
## &quot;+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs&quot; 
##  workshop_data/SampleData_Spatial/uintaN_fnfrcl.img 
## &quot;+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs&quot; 
##   workshop_data/SampleData_Spatial/uintaN_elevm.img 
## &quot;+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs&quot; 
##     workshop_data/SampleData_Spatial/uintaN_slp.img 
## &quot;+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs&quot; 
##  workshop_data/SampleData_Spatial/uintaN_aspval.img 
## &quot;+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs&quot;</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="dataanalytic-critique.html#cb41-1" aria-hidden="true"></a><span class="co">## Reproject SpatialPoints object to match raster projections. </span></span>
<span id="cb41-2"><a href="dataanalytic-critique.html#cb41-2" aria-hidden="true"></a><span class="kw">help</span>(project)</span>
<span id="cb41-3"><a href="dataanalytic-critique.html#cb41-3" aria-hidden="true"></a>rast.prj &lt;-<span class="st"> </span><span class="kw">projection</span>(<span class="kw">raster</span>(rastfnlst[<span class="dv">1</span>]))</span>
<span id="cb41-4"><a href="dataanalytic-critique.html#cb41-4" aria-hidden="true"></a>xy &lt;-<span class="st"> </span><span class="kw">cbind</span>(plt<span class="op">$</span>LON, plt<span class="op">$</span>LAT)</span>
<span id="cb41-5"><a href="dataanalytic-critique.html#cb41-5" aria-hidden="true"></a>xyprj &lt;-<span class="st"> </span><span class="kw">project</span>(xy, <span class="dt">proj=</span>rast.prj)</span>
<span id="cb41-6"><a href="dataanalytic-critique.html#cb41-6" aria-hidden="true"></a><span class="co">## Extract values (raster package)</span></span>
<span id="cb41-7"><a href="dataanalytic-critique.html#cb41-7" aria-hidden="true"></a><span class="kw">help</span>(extract)</span></code></pre></div>
<pre><code>## Help on topic &#39;extract&#39; was found in the following packages:
## 
##   Package               Library
##   raster                /Library/Frameworks/R.framework/Versions/4.0/Resources/library
##   magrittr              /Library/Frameworks/R.framework/Versions/4.0/Resources/library
## 
## 
## Using the first match ...</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="dataanalytic-critique.html#cb43-1" aria-hidden="true"></a><span class="co"># Let&#39;s extract values from 1 layer.</span></span>
<span id="cb43-2"><a href="dataanalytic-critique.html#cb43-2" aria-hidden="true"></a>tmp &lt;-<span class="st"> </span><span class="kw">extract</span>(<span class="kw">raster</span>(elevfn), xyprj)</span>
<span id="cb43-3"><a href="dataanalytic-critique.html#cb43-3" aria-hidden="true"></a><span class="kw">head</span>(tmp)</span></code></pre></div>
<pre><code>## [1] 2873 2575 2444 3474 2715 3360</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="dataanalytic-critique.html#cb45-1" aria-hidden="true"></a><span class="co"># Now, let&#39;s create a function to extract, so we can extract from all the rasters at the same time. </span></span>
<span id="cb45-2"><a href="dataanalytic-critique.html#cb45-2" aria-hidden="true"></a>extract.fun &lt;-<span class="st"> </span><span class="cf">function</span>(rast, xy){ <span class="kw">extract</span>(<span class="kw">raster</span>(rast), xy) }</span>
<span id="cb45-3"><a href="dataanalytic-critique.html#cb45-3" aria-hidden="true"></a></span>
<span id="cb45-4"><a href="dataanalytic-critique.html#cb45-4" aria-hidden="true"></a><span class="co"># Now, apply this function to the vector list of raster file names.</span></span>
<span id="cb45-5"><a href="dataanalytic-critique.html#cb45-5" aria-hidden="true"></a>rastext &lt;-<span class="st"> </span><span class="kw">sapply</span>(rastfnlst, extract.fun, xyprj)</span>
<span id="cb45-6"><a href="dataanalytic-critique.html#cb45-6" aria-hidden="true"></a></span>
<span id="cb45-7"><a href="dataanalytic-critique.html#cb45-7" aria-hidden="true"></a><span class="co"># Look at the output and check the class. </span></span>
<span id="cb45-8"><a href="dataanalytic-critique.html#cb45-8" aria-hidden="true"></a><span class="kw">head</span>(rastext)</span></code></pre></div>
<pre><code>##      workshop_data/SampleData_Spatial/uintaN_TMB5.img
## [1,]                                               72
## [2,]                                               93
## [3,]                                              129
## [4,]                                               98
## [5,]                                               98
## [6,]                                               60
##      workshop_data/SampleData_Spatial/uintaN_TMndvi.img
## [1,]                                                167
## [2,]                                                148
## [3,]                                                129
## [4,]                                                143
## [5,]                                                149
## [6,]                                                165
##      workshop_data/SampleData_Spatial/uintaN_fnfrcl.img
## [1,]                                                  1
## [2,]                                                  1
## [3,]                                                  2
## [4,]                                                  2
## [5,]                                                  1
## [6,]                                                  1
##      workshop_data/SampleData_Spatial/uintaN_elevm.img
## [1,]                                              2873
## [2,]                                              2575
## [3,]                                              2444
## [4,]                                              3474
## [5,]                                              2715
## [6,]                                              3360
##      workshop_data/SampleData_Spatial/uintaN_slp.img
## [1,]                                               6
## [2,]                                               6
## [3,]                                              28
## [4,]                                              18
## [5,]                                              19
## [6,]                                               7
##      workshop_data/SampleData_Spatial/uintaN_aspval.img
## [1,]                                                 42
## [2,]                                                  0
## [3,]                                                 99
## [4,]                                                 42
## [5,]                                                  1
## [6,]                                                 42</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="dataanalytic-critique.html#cb47-1" aria-hidden="true"></a><span class="kw">class</span>(rastext)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="dataanalytic-critique.html#cb49-1" aria-hidden="true"></a><span class="co">## Extract values (raster package) cont..  change names</span></span>
<span id="cb49-2"><a href="dataanalytic-critique.html#cb49-2" aria-hidden="true"></a></span>
<span id="cb49-3"><a href="dataanalytic-critique.html#cb49-3" aria-hidden="true"></a><span class="co"># Let&#39;s make the column names shorter. </span></span>
<span id="cb49-4"><a href="dataanalytic-critique.html#cb49-4" aria-hidden="true"></a><span class="kw">colnames</span>(rastext)</span></code></pre></div>
<pre><code>## [1] &quot;workshop_data/SampleData_Spatial/uintaN_TMB5.img&quot;  
## [2] &quot;workshop_data/SampleData_Spatial/uintaN_TMndvi.img&quot;
## [3] &quot;workshop_data/SampleData_Spatial/uintaN_fnfrcl.img&quot;
## [4] &quot;workshop_data/SampleData_Spatial/uintaN_elevm.img&quot; 
## [5] &quot;workshop_data/SampleData_Spatial/uintaN_slp.img&quot;   
## [6] &quot;workshop_data/SampleData_Spatial/uintaN_aspval.img&quot;</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="dataanalytic-critique.html#cb51-1" aria-hidden="true"></a><span class="co"># Use the rastfnlst vector of file names to get new column names.</span></span>
<span id="cb51-2"><a href="dataanalytic-critique.html#cb51-2" aria-hidden="true"></a><span class="co"># First, get the base name of each raster, without the extension.</span></span>
<span id="cb51-3"><a href="dataanalytic-critique.html#cb51-3" aria-hidden="true"></a>cnames &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">basename</span>(rastfnlst), <span class="st">&quot;.img&quot;</span>))</span>
<span id="cb51-4"><a href="dataanalytic-critique.html#cb51-4" aria-hidden="true"></a>cnames</span></code></pre></div>
<pre><code>## [1] &quot;uintaN_TMB5&quot;   &quot;uintaN_TMndvi&quot; &quot;uintaN_fnfrcl&quot; &quot;uintaN_elevm&quot; 
## [5] &quot;uintaN_slp&quot;    &quot;uintaN_aspval&quot;</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="dataanalytic-critique.html#cb53-1" aria-hidden="true"></a><span class="co"># We could stop here, but let&#39;s make the names even shorter and remove</span></span>
<span id="cb53-2"><a href="dataanalytic-critique.html#cb53-2" aria-hidden="true"></a><span class="co"># &#39;uintaN_&#39; from each name.</span></span>
<span id="cb53-3"><a href="dataanalytic-critique.html#cb53-3" aria-hidden="true"></a>cnames2 &lt;-<span class="st"> </span><span class="kw">substr</span>(cnames, <span class="dv">8</span>, <span class="kw">nchar</span>(cnames))</span>
<span id="cb53-4"><a href="dataanalytic-critique.html#cb53-4" aria-hidden="true"></a>cnames2</span></code></pre></div>
<pre><code>## [1] &quot;TMB5&quot;   &quot;TMndvi&quot; &quot;fnfrcl&quot; &quot;elevm&quot;  &quot;slp&quot;    &quot;aspval&quot;</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="dataanalytic-critique.html#cb55-1" aria-hidden="true"></a><span class="co"># Now, add names to matrix. Because the output is a matrix, we will use colnames.</span></span>
<span id="cb55-2"><a href="dataanalytic-critique.html#cb55-2" aria-hidden="true"></a><span class="kw">colnames</span>(rastext) &lt;-<span class="st"> </span>cnames2</span>
<span id="cb55-3"><a href="dataanalytic-critique.html#cb55-3" aria-hidden="true"></a><span class="kw">head</span>(rastext)</span></code></pre></div>
<pre><code>##      TMB5 TMndvi fnfrcl elevm slp aspval
## [1,]   72    167      1  2873   6     42
## [2,]   93    148      1  2575   6      0
## [3,]  129    129      2  2444  28     99
## [4,]   98    143      2  3474  18     42
## [5,]   98    149      1  2715  19      1
## [6,]   60    165      1  3360   7     42</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="dataanalytic-critique.html#cb57-1" aria-hidden="true"></a><span class="co"># Now, let&#39;s append this matrix to the plot table with the response data (plt2).</span></span>
<span id="cb57-2"><a href="dataanalytic-critique.html#cb57-2" aria-hidden="true"></a><span class="kw">head</span>(plt2)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 14
##   PLT_CN      CARBON_KG INVYR STATECD COUNTYCD  PLOT   LON   LAT NBRCND CRCOVPLT
##   &lt;chr&gt;           &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;    &lt;dbl&gt;
## 1 1193966501…      1840  2006      49        9 80275 -110.  40.9      1       50
## 2 1194012301…      5069  2006      49       13 80402 -110.  40.6      1       43
## 3 1194018001…      1416  2006      49       13 80936 -111.  40.6      1       28
## 4 1194028701…      1336  2006      49       13 82102 -110.  40.7      1       39
## 5 1194041401…      6512  2006      49       13 83586 -111.  40.6      1       38
## 6 1194050001…      3295  2006      49       13 83925 -110.  40.6      1       27
## # … with 4 more variables: CCLIVEPLT &lt;dbl&gt;, FORNONSAMP &lt;chr&gt;, ELEVM &lt;int&gt;,
## #   aspen &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="dataanalytic-critique.html#cb59-1" aria-hidden="true"></a><span class="co"># We just want the response variables, so let&#39;s extract these columns along with the unique identifier of the table (CN, aspen, CARBON_KG).</span></span>
<span id="cb59-2"><a href="dataanalytic-critique.html#cb59-2" aria-hidden="true"></a>modeldat &lt;-<span class="st"> </span><span class="kw">cbind</span>(plt2[,<span class="kw">c</span>(<span class="st">&quot;PLT_CN&quot;</span>, <span class="st">&quot;aspen&quot;</span>, <span class="st">&quot;CARBON_KG&quot;</span>)], rastext)</span>
<span id="cb59-3"><a href="dataanalytic-critique.html#cb59-3" aria-hidden="true"></a><span class="kw">head</span>(modeldat)</span></code></pre></div>
<pre><code>##           PLT_CN aspen CARBON_KG TMB5 TMndvi fnfrcl elevm slp aspval
## 1 11939665010690     0      1840   72    167      1  2873   6     42
## 2 11940123010690     0      5069   93    148      1  2575   6      0
## 3 11940180010690     0      1416  129    129      2  2444  28     99
## 4 11940287010690     0      1336   98    143      2  3474  18     42
## 5 11940414010690     0      6512   98    149      1  2715  19      1
## 6 11940500010690     0      3295   60    165      1  3360   7     42</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="dataanalytic-critique.html#cb61-1" aria-hidden="true"></a><span class="co"># Check if this is a data frame</span></span>
<span id="cb61-2"><a href="dataanalytic-critique.html#cb61-2" aria-hidden="true"></a><span class="kw">is.data.frame</span>(modeldat)     </span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="dataanalytic-critique.html#cb63-1" aria-hidden="true"></a><span class="kw">dim</span>(modeldat)</span></code></pre></div>
<pre><code>## [1] 288   9</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="dataanalytic-critique.html#cb65-1" aria-hidden="true"></a><span class="co"># Let&#39;s also append the projected xy coordinates for overlaying with raster layers.</span></span>
<span id="cb65-2"><a href="dataanalytic-critique.html#cb65-2" aria-hidden="true"></a>modeldat &lt;-<span class="st"> </span><span class="kw">cbind</span>(xyprj, modeldat)</span>
<span id="cb65-3"><a href="dataanalytic-critique.html#cb65-3" aria-hidden="true"></a><span class="kw">head</span>(modeldat)</span></code></pre></div>
<pre><code>##          1       2         PLT_CN aspen CARBON_KG TMB5 TMndvi fnfrcl elevm slp
## 1 589393.4 4530338 11939665010690     0      1840   72    167      1  2873   6
## 2 599757.3 4525551 11940123010690     0      5069   93    148      1  2575   6
## 3 594947.7 4535131 11940180010690     0      1416  129    129      2  2444  28
## 4 550308.7 4505418 11940287010690     0      1336   98    143      2  3474  18
## 5 548315.9 4487922 11940414010690     0      6512   98    149      1  2715  19
## 6 559454.7 4510667 11940500010690     0      3295   60    165      1  3360   7
##   aspval
## 1     42
## 2      0
## 3     99
## 4     42
## 5      1
## 6     42</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="dataanalytic-critique.html#cb67-1" aria-hidden="true"></a><span class="kw">colnames</span>(modeldat)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb67-2"><a href="dataanalytic-critique.html#cb67-2" aria-hidden="true"></a><span class="kw">head</span>(modeldat)</span></code></pre></div>
<pre><code>##          X       Y         PLT_CN aspen CARBON_KG TMB5 TMndvi fnfrcl elevm slp
## 1 589393.4 4530338 11939665010690     0      1840   72    167      1  2873   6
## 2 599757.3 4525551 11940123010690     0      5069   93    148      1  2575   6
## 3 594947.7 4535131 11940180010690     0      1416  129    129      2  2444  28
## 4 550308.7 4505418 11940287010690     0      1336   98    143      2  3474  18
## 5 548315.9 4487922 11940414010690     0      6512   98    149      1  2715  19
## 6 559454.7 4510667 11940500010690     0      3295   60    165      1  3360   7
##   aspval
## 1     42
## 2      0
## 3     99
## 4     42
## 5      1
## 6     42</code></pre>
<p>Now follow along with the <strong>Data Exploration</strong> section of the workshop slides. Think about what you would change and what you might leave the same regarding coding style and workflow.</p>
<p>Now we will continue on with the <strong>Modelling Generation</strong> section of the workshop slides, following the code below.
<img src="img/generation.png" alt="slide from workshop" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="dataanalytic-critique.html#cb69-1" aria-hidden="true"></a><span class="kw">library</span>(rpart)</span>
<span id="cb69-2"><a href="dataanalytic-critique.html#cb69-2" aria-hidden="true"></a></span>
<span id="cb69-3"><a href="dataanalytic-critique.html#cb69-3" aria-hidden="true"></a><span class="co">## Classification tree</span></span>
<span id="cb69-4"><a href="dataanalytic-critique.html#cb69-4" aria-hidden="true"></a>asp.tree &lt;-<span class="st"> </span><span class="kw">rpart</span>(aspen <span class="op">~</span><span class="st"> </span>TMB5 <span class="op">+</span><span class="st"> </span>TMndvi <span class="op">+</span><span class="st"> </span>fnfrcl <span class="op">+</span><span class="st"> </span>elevm <span class="op">+</span><span class="st"> </span>slp <span class="op">+</span><span class="st"> </span>aspval,    <span class="dt">data=</span>modeldat, <span class="dt">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb69-5"><a href="dataanalytic-critique.html#cb69-5" aria-hidden="true"></a></span>
<span id="cb69-6"><a href="dataanalytic-critique.html#cb69-6" aria-hidden="true"></a><span class="kw">plot</span>(asp.tree)</span>
<span id="cb69-7"><a href="dataanalytic-critique.html#cb69-7" aria-hidden="true"></a><span class="kw">text</span>(asp.tree, <span class="dt">cex=</span><span class="fl">0.75</span>)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="dataanalytic-critique.html#cb70-1" aria-hidden="true"></a><span class="co">## Regression tree</span></span>
<span id="cb70-2"><a href="dataanalytic-critique.html#cb70-2" aria-hidden="true"></a>carb.tree &lt;-<span class="st"> </span><span class="kw">rpart</span>(CARBON_KG <span class="op">~</span><span class="st"> </span>TMB5 <span class="op">+</span><span class="st"> </span>TMndvi <span class="op">+</span><span class="st"> </span>fnfrcl <span class="op">+</span><span class="st"> </span>elevm <span class="op">+</span><span class="st"> </span>slp <span class="op">+</span><span class="st"> </span>aspval,   <span class="dt">data=</span>modeldat)</span>
<span id="cb70-3"><a href="dataanalytic-critique.html#cb70-3" aria-hidden="true"></a><span class="kw">plot</span>(carb.tree)</span>
<span id="cb70-4"><a href="dataanalytic-critique.html#cb70-4" aria-hidden="true"></a><span class="kw">text</span>(carb.tree, <span class="dt">cex=</span><span class="fl">0.75</span>)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<p>Now move to Random Forest modelling</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="dataanalytic-critique.html#cb71-1" aria-hidden="true"></a><span class="co">## Now, let&#39;s use the randomForests package – Classification tree</span></span>
<span id="cb71-2"><a href="dataanalytic-critique.html#cb71-2" aria-hidden="true"></a><span class="kw">library</span>(randomForest)</span>
<span id="cb71-3"><a href="dataanalytic-critique.html#cb71-3" aria-hidden="true"></a><span class="kw">help</span>(randomForest)</span>
<span id="cb71-4"><a href="dataanalytic-critique.html#cb71-4" aria-hidden="true"></a></span>
<span id="cb71-5"><a href="dataanalytic-critique.html#cb71-5" aria-hidden="true"></a><span class="co">## Let&#39;s try with ASPEN binary, categorical response (presence/absence)</span></span>
<span id="cb71-6"><a href="dataanalytic-critique.html#cb71-6" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">66</span>)</span>
<span id="cb71-7"><a href="dataanalytic-critique.html#cb71-7" aria-hidden="true"></a>asp.mod &lt;-<span class="st"> </span><span class="kw">randomForest</span>(<span class="kw">factor</span>(aspen) <span class="op">~</span><span class="st"> </span>TMB5 <span class="op">+</span><span class="st"> </span>TMndvi <span class="op">+</span><span class="st"> </span>fnfrcl <span class="op">+</span><span class="st"> </span>elevm <span class="op">+</span><span class="st"> </span>slp <span class="op">+</span><span class="st"> </span>aspval,  <span class="dt">data=</span>modeldat, <span class="dt">importance =</span> <span class="ot">TRUE</span>, <span class="dt">na.action =</span> na.exclude)</span>
<span id="cb71-8"><a href="dataanalytic-critique.html#cb71-8" aria-hidden="true"></a></span>
<span id="cb71-9"><a href="dataanalytic-critique.html#cb71-9" aria-hidden="true"></a></span>
<span id="cb71-10"><a href="dataanalytic-critique.html#cb71-10" aria-hidden="true"></a><span class="co">## Default parameters:</span></span>
<span id="cb71-11"><a href="dataanalytic-critique.html#cb71-11" aria-hidden="true"></a><span class="co"># ntree = 500   # Number of trees</span></span>
<span id="cb71-12"><a href="dataanalytic-critique.html#cb71-12" aria-hidden="true"></a><span class="co"># mtry = sqrt(p)    # Number of predictors (p) randomly sampled at each node</span></span>
<span id="cb71-13"><a href="dataanalytic-critique.html#cb71-13" aria-hidden="true"></a><span class="co"># nodesize = 1  # Minimum size of terminal nodes</span></span>
<span id="cb71-14"><a href="dataanalytic-critique.html#cb71-14" aria-hidden="true"></a><span class="co"># replace = TRUE    # Bootstrap samples are selected with replacement   </span></span>
<span id="cb71-15"><a href="dataanalytic-critique.html#cb71-15" aria-hidden="true"></a></span>
<span id="cb71-16"><a href="dataanalytic-critique.html#cb71-16" aria-hidden="true"></a></span>
<span id="cb71-17"><a href="dataanalytic-critique.html#cb71-17" aria-hidden="true"></a><span class="co">## Look at results</span></span>
<span id="cb71-18"><a href="dataanalytic-critique.html#cb71-18" aria-hidden="true"></a>asp.mod</span></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = factor(aspen) ~ TMB5 + TMndvi + fnfrcl +      elevm + slp + aspval, data = modeldat, importance = TRUE,      na.action = na.exclude) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 2
## 
##         OOB estimate of  error rate: 25%
## Confusion matrix:
##     0  1 class.error
## 0 212 11  0.04932735
## 1  60  1  0.98360656</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="dataanalytic-critique.html#cb73-1" aria-hidden="true"></a><span class="kw">summary</span>(asp.mod)</span></code></pre></div>
<pre><code>##                 Length Class   Mode     
## call               5   -none-  call     
## type               1   -none-  character
## predicted        284   factor  numeric  
## err.rate        1500   -none-  numeric  
## confusion          6   -none-  numeric  
## votes            568   matrix  numeric  
## oob.times        284   -none-  numeric  
## classes            2   -none-  character
## importance        24   -none-  numeric  
## importanceSD      18   -none-  numeric  
## localImportance    0   -none-  NULL     
## proximity          0   -none-  NULL     
## ntree              1   -none-  numeric  
## mtry               1   -none-  numeric  
## forest            14   -none-  list     
## y                284   factor  numeric  
## test               0   -none-  NULL     
## inbag              0   -none-  NULL     
## terms              3   terms   call     
## na.action          4   exclude numeric</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="dataanalytic-critique.html#cb75-1" aria-hidden="true"></a><span class="kw">names</span>(asp.mod)</span></code></pre></div>
<pre><code>##  [1] &quot;call&quot;            &quot;type&quot;            &quot;predicted&quot;       &quot;err.rate&quot;       
##  [5] &quot;confusion&quot;       &quot;votes&quot;           &quot;oob.times&quot;       &quot;classes&quot;        
##  [9] &quot;importance&quot;      &quot;importanceSD&quot;    &quot;localImportance&quot; &quot;proximity&quot;      
## [13] &quot;ntree&quot;           &quot;mtry&quot;            &quot;forest&quot;          &quot;y&quot;              
## [17] &quot;test&quot;            &quot;inbag&quot;           &quot;terms&quot;           &quot;na.action&quot;</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="dataanalytic-critique.html#cb77-1" aria-hidden="true"></a>err &lt;-<span class="st"> </span>asp.mod<span class="op">$</span>err.rate <span class="co"># Out-Of-Bag (OOB) error rate (of i-th element)</span></span>
<span id="cb77-2"><a href="dataanalytic-critique.html#cb77-2" aria-hidden="true"></a><span class="kw">head</span>(err)</span></code></pre></div>
<pre><code>##            OOB         0         1
## [1,] 0.2884615 0.2093023 0.6666667
## [2,] 0.3657143 0.2928571 0.6571429
## [3,] 0.3443396 0.2690058 0.6585366
## [4,] 0.3319672 0.2164948 0.7800000
## [5,] 0.3307393 0.1881188 0.8545455
## [6,] 0.3159851 0.1753555 0.8275862</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="dataanalytic-critique.html#cb79-1" aria-hidden="true"></a><span class="kw">tail</span>(err)</span></code></pre></div>
<pre><code>##              OOB          0         1
## [495,] 0.2500000 0.04932735 0.9836066
## [496,] 0.2500000 0.04932735 0.9836066
## [497,] 0.2500000 0.04932735 0.9836066
## [498,] 0.2500000 0.04932735 0.9836066
## [499,] 0.2535211 0.05381166 0.9836066
## [500,] 0.2500000 0.04932735 0.9836066</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="dataanalytic-critique.html#cb81-1" aria-hidden="true"></a>mat &lt;-<span class="st"> </span>asp.mod<span class="op">$</span>confusion    <span class="co"># Confusion matrix</span></span>
<span id="cb81-2"><a href="dataanalytic-critique.html#cb81-2" aria-hidden="true"></a>mat</span></code></pre></div>
<pre><code>##     0  1 class.error
## 0 212 11  0.04932735
## 1  60  1  0.98360656</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="dataanalytic-critique.html#cb83-1" aria-hidden="true"></a><span class="co">## Classification tree - Output</span></span>
<span id="cb83-2"><a href="dataanalytic-critique.html#cb83-2" aria-hidden="true"></a></span>
<span id="cb83-3"><a href="dataanalytic-critique.html#cb83-3" aria-hidden="true"></a><span class="co"># Plot the number of trees by the error rate</span></span>
<span id="cb83-4"><a href="dataanalytic-critique.html#cb83-4" aria-hidden="true"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>, err[,<span class="st">&quot;OOB&quot;</span>], <span class="dt">xlab=</span><span class="st">&quot;Number of trees&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Error rate&quot;</span>)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="dataanalytic-critique.html#cb84-1" aria-hidden="true"></a><span class="co"># Note: how many trees needed to stabilize prediction</span></span>
<span id="cb84-2"><a href="dataanalytic-critique.html#cb84-2" aria-hidden="true"></a></span>
<span id="cb84-3"><a href="dataanalytic-critique.html#cb84-3" aria-hidden="true"></a><span class="co">## Calculate the percent correctly classified from confusion (error) matrix</span></span>
<span id="cb84-4"><a href="dataanalytic-critique.html#cb84-4" aria-hidden="true"></a>mat</span></code></pre></div>
<pre><code>##     0  1 class.error
## 0 212 11  0.04932735
## 1  60  1  0.98360656</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="dataanalytic-critique.html#cb86-1" aria-hidden="true"></a>pcc &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">diag</span>(mat[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]))<span class="op">/</span><span class="kw">sum</span>(mat) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb86-2"><a href="dataanalytic-critique.html#cb86-2" aria-hidden="true"></a>pcc</span></code></pre></div>
<pre><code>## [1] 74.72821</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="dataanalytic-critique.html#cb88-1" aria-hidden="true"></a>pcc &lt;-<span class="st"> </span><span class="kw">round</span>(pcc, <span class="dv">2</span>)    <span class="co">## Round to nearest 2 decimals</span></span>
<span id="cb88-2"><a href="dataanalytic-critique.html#cb88-2" aria-hidden="true"></a>pcc</span></code></pre></div>
<pre><code>## [1] 74.73</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="dataanalytic-critique.html#cb90-1" aria-hidden="true"></a><span class="kw">library</span>(PresenceAbsence)</span>
<span id="cb90-2"><a href="dataanalytic-critique.html#cb90-2" aria-hidden="true"></a><span class="kw">pcc</span>(mat[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">st.dev=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##    PCC     PCC.sd
## 1 0.75 0.02573993</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="dataanalytic-critique.html#cb92-1" aria-hidden="true"></a><span class="kw">Kappa</span>(mat[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">st.dev=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##         Kappa  Kappa.sd
## 0 -0.04650197 0.0302359</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="dataanalytic-critique.html#cb94-1" aria-hidden="true"></a><span class="co">## The Kappa statistic summarizes all the available information in the confusion matrix.</span></span>
<span id="cb94-2"><a href="dataanalytic-critique.html#cb94-2" aria-hidden="true"></a><span class="co">## Kappa measures the proportion of correctly classified units after accounting for the probability of chance agreement.</span></span>
<span id="cb94-3"><a href="dataanalytic-critique.html#cb94-3" aria-hidden="true"></a></span>
<span id="cb94-4"><a href="dataanalytic-critique.html#cb94-4" aria-hidden="true"></a><span class="co">## Now, let&#39;s use the randomForests package – regression tree</span></span>
<span id="cb94-5"><a href="dataanalytic-critique.html#cb94-5" aria-hidden="true"></a></span>
<span id="cb94-6"><a href="dataanalytic-critique.html#cb94-6" aria-hidden="true"></a><span class="co">## Now, let&#39;s try with the continuous, CARBON_KG response</span></span>
<span id="cb94-7"><a href="dataanalytic-critique.html#cb94-7" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">66</span>)</span>
<span id="cb94-8"><a href="dataanalytic-critique.html#cb94-8" aria-hidden="true"></a>carb.mod &lt;-<span class="st"> </span><span class="kw">randomForest</span>(CARBON_KG <span class="op">~</span><span class="st"> </span>TMB5 <span class="op">+</span><span class="st"> </span>TMndvi <span class="op">+</span><span class="st"> </span>elevm <span class="op">+</span><span class="st"> </span>slp <span class="op">+</span><span class="st"> </span>aspval,  <span class="dt">data=</span>modeldat, <span class="dt">importance =</span> <span class="ot">TRUE</span>, <span class="dt">na.action=</span>na.exclude)</span>
<span id="cb94-9"><a href="dataanalytic-critique.html#cb94-9" aria-hidden="true"></a></span>
<span id="cb94-10"><a href="dataanalytic-critique.html#cb94-10" aria-hidden="true"></a><span class="co">## Default parameters:</span></span>
<span id="cb94-11"><a href="dataanalytic-critique.html#cb94-11" aria-hidden="true"></a><span class="co"># ntree = 500   # Number of trees</span></span>
<span id="cb94-12"><a href="dataanalytic-critique.html#cb94-12" aria-hidden="true"></a><span class="co"># mtry = p/3    # Number of predictors (p) randomly sampled at each node</span></span>
<span id="cb94-13"><a href="dataanalytic-critique.html#cb94-13" aria-hidden="true"></a><span class="co"># nodesize = 5  # Minimum size of terminal nodes</span></span>
<span id="cb94-14"><a href="dataanalytic-critique.html#cb94-14" aria-hidden="true"></a><span class="co"># replace = TRUE    # Bootstrap samples are selected with replacement   </span></span>
<span id="cb94-15"><a href="dataanalytic-critique.html#cb94-15" aria-hidden="true"></a></span>
<span id="cb94-16"><a href="dataanalytic-critique.html#cb94-16" aria-hidden="true"></a><span class="co">## Look at results</span></span>
<span id="cb94-17"><a href="dataanalytic-critique.html#cb94-17" aria-hidden="true"></a>carb.mod</span></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = CARBON_KG ~ TMB5 + TMndvi + elevm + slp +      aspval, data = modeldat, importance = TRUE, na.action = na.exclude) 
##                Type of random forest: regression
##                      Number of trees: 500
## No. of variables tried at each split: 1
## 
##           Mean of squared residuals: 4130918
##                     % Var explained: -7.24</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="dataanalytic-critique.html#cb96-1" aria-hidden="true"></a><span class="kw">summary</span>(carb.mod)</span></code></pre></div>
<pre><code>##                 Length Class   Mode     
## call              5    -none-  call     
## type              1    -none-  character
## predicted       284    -none-  numeric  
## mse             500    -none-  numeric  
## rsq             500    -none-  numeric  
## oob.times       284    -none-  numeric  
## importance       10    -none-  numeric  
## importanceSD      5    -none-  numeric  
## localImportance   0    -none-  NULL     
## proximity         0    -none-  NULL     
## ntree             1    -none-  numeric  
## mtry              1    -none-  numeric  
## forest           11    -none-  list     
## coefs             0    -none-  NULL     
## y               284    -none-  numeric  
## test              0    -none-  NULL     
## inbag             0    -none-  NULL     
## terms             3    terms   call     
## na.action         4    exclude numeric</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="dataanalytic-critique.html#cb98-1" aria-hidden="true"></a><span class="kw">names</span>(carb.mod)</span></code></pre></div>
<pre><code>##  [1] &quot;call&quot;            &quot;type&quot;            &quot;predicted&quot;       &quot;mse&quot;            
##  [5] &quot;rsq&quot;             &quot;oob.times&quot;       &quot;importance&quot;      &quot;importanceSD&quot;   
##  [9] &quot;localImportance&quot; &quot;proximity&quot;       &quot;ntree&quot;           &quot;mtry&quot;           
## [13] &quot;forest&quot;          &quot;coefs&quot;           &quot;y&quot;               &quot;test&quot;           
## [17] &quot;inbag&quot;           &quot;terms&quot;           &quot;na.action&quot;</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="dataanalytic-critique.html#cb100-1" aria-hidden="true"></a><span class="co">## Regression tree - Output</span></span>
<span id="cb100-2"><a href="dataanalytic-critique.html#cb100-2" aria-hidden="true"></a></span>
<span id="cb100-3"><a href="dataanalytic-critique.html#cb100-3" aria-hidden="true"></a><span class="kw">names</span>(carb.mod)</span></code></pre></div>
<pre><code>##  [1] &quot;call&quot;            &quot;type&quot;            &quot;predicted&quot;       &quot;mse&quot;            
##  [5] &quot;rsq&quot;             &quot;oob.times&quot;       &quot;importance&quot;      &quot;importanceSD&quot;   
##  [9] &quot;localImportance&quot; &quot;proximity&quot;       &quot;ntree&quot;           &quot;mtry&quot;           
## [13] &quot;forest&quot;          &quot;coefs&quot;           &quot;y&quot;               &quot;test&quot;           
## [17] &quot;inbag&quot;           &quot;terms&quot;           &quot;na.action&quot;</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="dataanalytic-critique.html#cb102-1" aria-hidden="true"></a>mse &lt;-<span class="st"> </span>carb.mod<span class="op">$</span>mse <span class="co"># Mean square error (of i-th element) </span></span>
<span id="cb102-2"><a href="dataanalytic-critique.html#cb102-2" aria-hidden="true"></a>rsq &lt;-<span class="st"> </span>carb.mod<span class="op">$</span>rsq <span class="co"># Pseudo R-squared (1-mse/Var(y))(of i-th element)</span></span>
<span id="cb102-3"><a href="dataanalytic-critique.html#cb102-3" aria-hidden="true"></a></span>
<span id="cb102-4"><a href="dataanalytic-critique.html#cb102-4" aria-hidden="true"></a><span class="kw">head</span>(mse)</span></code></pre></div>
<pre><code>## [1] 6129997 5570019 5498393 5421758 5356727 5171813</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="dataanalytic-critique.html#cb104-1" aria-hidden="true"></a><span class="kw">tail</span>(mse)</span></code></pre></div>
<pre><code>## [1] 4128044 4129220 4130748 4130852 4130664 4130918</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="dataanalytic-critique.html#cb106-1" aria-hidden="true"></a><span class="kw">tail</span>(rsq)</span></code></pre></div>
<pre><code>## [1] -0.07163319 -0.07193863 -0.07233534 -0.07236227 -0.07231334 -0.07237937</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="dataanalytic-critique.html#cb108-1" aria-hidden="true"></a><span class="co">## Regression tree - Output</span></span>
<span id="cb108-2"><a href="dataanalytic-critique.html#cb108-2" aria-hidden="true"></a></span>
<span id="cb108-3"><a href="dataanalytic-critique.html#cb108-3" aria-hidden="true"></a><span class="co"># Plot the number of trees by the mse (Mean Square Error)</span></span>
<span id="cb108-4"><a href="dataanalytic-critique.html#cb108-4" aria-hidden="true"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>, mse, <span class="dt">xlab=</span><span class="st">&quot;Number of trees&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean Square Error rate&quot;</span>)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="dataanalytic-critique.html#cb109-1" aria-hidden="true"></a><span class="co"># Note: how many trees needed to stabilize prediction</span></span>
<span id="cb109-2"><a href="dataanalytic-critique.html#cb109-2" aria-hidden="true"></a></span>
<span id="cb109-3"><a href="dataanalytic-critique.html#cb109-3" aria-hidden="true"></a><span class="co"># Similarly, plot the number of trees by the rsq (R-Squared)</span></span>
<span id="cb109-4"><a href="dataanalytic-critique.html#cb109-4" aria-hidden="true"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>, rsq, <span class="dt">xlab=</span><span class="st">&quot;Number of trees&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;R-Squared&quot;</span>)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-11-3.png" width="672" /></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="dataanalytic-critique.html#cb110-1" aria-hidden="true"></a><span class="co"># Again: how many trees needed to stabilize prediction</span></span>
<span id="cb110-2"><a href="dataanalytic-critique.html#cb110-2" aria-hidden="true"></a></span>
<span id="cb110-3"><a href="dataanalytic-critique.html#cb110-3" aria-hidden="true"></a><span class="co">## Variable importance – Classification tree</span></span>
<span id="cb110-4"><a href="dataanalytic-critique.html#cb110-4" aria-hidden="true"></a></span>
<span id="cb110-5"><a href="dataanalytic-critique.html#cb110-5" aria-hidden="true"></a><span class="co">## Get importance table</span></span>
<span id="cb110-6"><a href="dataanalytic-critique.html#cb110-6" aria-hidden="true"></a>asp.imp &lt;-<span class="st"> </span><span class="kw">abs</span>(asp.mod<span class="op">$</span>importance)</span>
<span id="cb110-7"><a href="dataanalytic-critique.html#cb110-7" aria-hidden="true"></a>asp.imp</span></code></pre></div>
<pre><code>##                  0             1 MeanDecreaseAccuracy MeanDecreaseGini
## TMB5   0.008492861 0.00106732947          0.006720638        21.870695
## TMndvi 0.011361022 0.00090855490          0.008877476        19.303862
## fnfrcl 0.002862576 0.00194577172          0.002638871         1.435293
## elevm  0.001779809 0.00005164993          0.001533177        22.726870
## slp    0.004208594 0.00629447891          0.001934033        15.954537
## aspval 0.007676320 0.00664058231          0.007516978        12.314229</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="dataanalytic-critique.html#cb112-1" aria-hidden="true"></a><span class="co">## Get the number of measures (columns) and number of predictors</span></span>
<span id="cb112-2"><a href="dataanalytic-critique.html#cb112-2" aria-hidden="true"></a>ncols &lt;-<span class="st"> </span><span class="kw">ncol</span>(asp.imp)      <span class="co">## Number of measures</span></span>
<span id="cb112-3"><a href="dataanalytic-critique.html#cb112-3" aria-hidden="true"></a>numpred &lt;-<span class="st"> </span><span class="kw">nrow</span>(asp.imp)        <span class="co">## Get number of predictors</span></span>
<span id="cb112-4"><a href="dataanalytic-critique.html#cb112-4" aria-hidden="true"></a></span>
<span id="cb112-5"><a href="dataanalytic-critique.html#cb112-5" aria-hidden="true"></a></span>
<span id="cb112-6"><a href="dataanalytic-critique.html#cb112-6" aria-hidden="true"></a><span class="co">## Plot the measures of variable importance for ASPEN presence/absence</span></span>
<span id="cb112-7"><a href="dataanalytic-critique.html#cb112-7" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb112-8"><a href="dataanalytic-critique.html#cb112-8" aria-hidden="true"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>ncols){  <span class="co">## Loop thru the different importance measures</span></span>
<span id="cb112-9"><a href="dataanalytic-critique.html#cb112-9" aria-hidden="true"></a>    ivect &lt;-<span class="st"> </span><span class="kw">sort</span>(asp.imp[,i], <span class="dt">dec=</span><span class="ot">TRUE</span>)        <span class="co">## Get 1st measure, descending order</span></span>
<span id="cb112-10"><a href="dataanalytic-critique.html#cb112-10" aria-hidden="true"></a>    iname &lt;-<span class="st"> </span><span class="kw">colnames</span>(asp.imp)[i]       <span class="co">## Get name of measure</span></span>
<span id="cb112-11"><a href="dataanalytic-critique.html#cb112-11" aria-hidden="true"></a></span>
<span id="cb112-12"><a href="dataanalytic-critique.html#cb112-12" aria-hidden="true"></a>    <span class="co"># Generate histogram plot (type=&#39;h&#39;) with no x axis (xaxt=&#39;n&#39;)</span></span>
<span id="cb112-13"><a href="dataanalytic-critique.html#cb112-13" aria-hidden="true"></a>    <span class="kw">plot</span>(ivect, <span class="dt">type =</span> <span class="st">&quot;h&quot;</span>, <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;Measure&quot;</span>, iname), <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb112-14"><a href="dataanalytic-critique.html#cb112-14" aria-hidden="true"></a>        <span class="dt">xlab =</span> <span class="st">&quot;Predictors&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">max</span>(ivect)))</span>
<span id="cb112-15"><a href="dataanalytic-critique.html#cb112-15" aria-hidden="true"></a></span>
<span id="cb112-16"><a href="dataanalytic-critique.html#cb112-16" aria-hidden="true"></a>    <span class="co"># Add x axis with associated labels</span></span>
<span id="cb112-17"><a href="dataanalytic-critique.html#cb112-17" aria-hidden="true"></a>    <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="dv">1</span><span class="op">:</span>numpred, <span class="dt">lab=</span><span class="kw">names</span>(ivect)) </span>
<span id="cb112-18"><a href="dataanalytic-critique.html#cb112-18" aria-hidden="true"></a>}</span>
<span id="cb112-19"><a href="dataanalytic-critique.html#cb112-19" aria-hidden="true"></a></span>
<span id="cb112-20"><a href="dataanalytic-critique.html#cb112-20" aria-hidden="true"></a><span class="co">## Let’s make a function and plot importance values for CARBON_KG model.</span></span>
<span id="cb112-21"><a href="dataanalytic-critique.html#cb112-21" aria-hidden="true"></a></span>
<span id="cb112-22"><a href="dataanalytic-critique.html#cb112-22" aria-hidden="true"></a>plotimp &lt;-<span class="st"> </span><span class="cf">function</span>(itab){</span>
<span id="cb112-23"><a href="dataanalytic-critique.html#cb112-23" aria-hidden="true"></a>    ncols &lt;-<span class="st"> </span><span class="kw">ncol</span>(itab)         <span class="co">## Number of measures</span></span>
<span id="cb112-24"><a href="dataanalytic-critique.html#cb112-24" aria-hidden="true"></a>    numpred &lt;-<span class="st"> </span><span class="kw">nrow</span>(itab)       <span class="co">## Get number of predictors</span></span>
<span id="cb112-25"><a href="dataanalytic-critique.html#cb112-25" aria-hidden="true"></a></span>
<span id="cb112-26"><a href="dataanalytic-critique.html#cb112-26" aria-hidden="true"></a>    <span class="co">## Plot the measures of variable importance </span></span>
<span id="cb112-27"><a href="dataanalytic-critique.html#cb112-27" aria-hidden="true"></a>    <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(ncols<span class="op">/</span><span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb112-28"><a href="dataanalytic-critique.html#cb112-28" aria-hidden="true"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>ncols){  <span class="co">## Loop thru the different importance measures</span></span>
<span id="cb112-29"><a href="dataanalytic-critique.html#cb112-29" aria-hidden="true"></a>        ivect &lt;-<span class="st"> </span><span class="kw">sort</span>(itab[,i], <span class="dt">dec=</span><span class="ot">TRUE</span>)   <span class="co">## Get 1st measure, sorted decreasing</span></span>
<span id="cb112-30"><a href="dataanalytic-critique.html#cb112-30" aria-hidden="true"></a>        iname &lt;-<span class="st"> </span><span class="kw">colnames</span>(itab)[i]      <span class="co">## Get name of measure</span></span>
<span id="cb112-31"><a href="dataanalytic-critique.html#cb112-31" aria-hidden="true"></a></span>
<span id="cb112-32"><a href="dataanalytic-critique.html#cb112-32" aria-hidden="true"></a>        <span class="co"># Generate histogram plot (type=&#39;h&#39;) with no x axis (xaxt=&#39;n&#39;)</span></span>
<span id="cb112-33"><a href="dataanalytic-critique.html#cb112-33" aria-hidden="true"></a>        <span class="kw">plot</span>(ivect, <span class="dt">type =</span> <span class="st">&quot;h&quot;</span>, <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;Measure&quot;</span>, iname), <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb112-34"><a href="dataanalytic-critique.html#cb112-34" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;Predictors&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="kw">max</span>(ivect)))</span>
<span id="cb112-35"><a href="dataanalytic-critique.html#cb112-35" aria-hidden="true"></a></span>
<span id="cb112-36"><a href="dataanalytic-critique.html#cb112-36" aria-hidden="true"></a>        <span class="co"># Add x axis with associated labels</span></span>
<span id="cb112-37"><a href="dataanalytic-critique.html#cb112-37" aria-hidden="true"></a>        <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="dv">1</span><span class="op">:</span>numpred, <span class="dt">lab=</span><span class="kw">names</span>(ivect)) }</span>
<span id="cb112-38"><a href="dataanalytic-critique.html#cb112-38" aria-hidden="true"></a>}</span>
<span id="cb112-39"><a href="dataanalytic-critique.html#cb112-39" aria-hidden="true"></a></span>
<span id="cb112-40"><a href="dataanalytic-critique.html#cb112-40" aria-hidden="true"></a><span class="co">## Check function with ASPEN model</span></span>
<span id="cb112-41"><a href="dataanalytic-critique.html#cb112-41" aria-hidden="true"></a><span class="kw">plotimp</span>(asp.imp)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-11-4.png" width="672" /></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="dataanalytic-critique.html#cb113-1" aria-hidden="true"></a><span class="co">## Now, run funtion with CARBON_KG model</span></span>
<span id="cb113-2"><a href="dataanalytic-critique.html#cb113-2" aria-hidden="true"></a><span class="kw">plotimp</span>(carb.mod<span class="op">$</span>importance)</span></code></pre></div>
<p><img src="gg501_files/figure-html/unnamed-chunk-11-5.png" width="672" /></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="dataanalytic-critique.html#cb114-1" aria-hidden="true"></a><span class="co">## Other information from RandomForest model (proximity=TRUE)</span></span>
<span id="cb114-2"><a href="dataanalytic-critique.html#cb114-2" aria-hidden="true"></a></span>
<span id="cb114-3"><a href="dataanalytic-critique.html#cb114-3" aria-hidden="true"></a><span class="co"># Measure of internal structure (Proximity measure)</span></span>
<span id="cb114-4"><a href="dataanalytic-critique.html#cb114-4" aria-hidden="true"></a>    <span class="co"># - The fraction of trees in which each plot falls in the same terminal node.</span></span>
<span id="cb114-5"><a href="dataanalytic-critique.html#cb114-5" aria-hidden="true"></a></span>
<span id="cb114-6"><a href="dataanalytic-critique.html#cb114-6" aria-hidden="true"></a><span class="co"># - Similarity measure - in theory, similar data points will end up in the same terminal node.</span></span>
<span id="cb114-7"><a href="dataanalytic-critique.html#cb114-7" aria-hidden="true"></a></span>
<span id="cb114-8"><a href="dataanalytic-critique.html#cb114-8" aria-hidden="true"></a></span>
<span id="cb114-9"><a href="dataanalytic-critique.html#cb114-9" aria-hidden="true"></a><span class="co">## Let&#39;s try adding proximity to CARBON_KG model</span></span>
<span id="cb114-10"><a href="dataanalytic-critique.html#cb114-10" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">66</span>)</span>
<span id="cb114-11"><a href="dataanalytic-critique.html#cb114-11" aria-hidden="true"></a>carb.mod &lt;-<span class="st"> </span><span class="kw">randomForest</span>(CARBON_KG <span class="op">~</span><span class="st"> </span>TMB5 <span class="op">+</span><span class="st"> </span>TMndvi <span class="op">+</span><span class="st"> </span>elevm <span class="op">+</span><span class="st"> </span>slp <span class="op">+</span><span class="st"> </span>aspval,  <span class="dt">data=</span>modeldat, <span class="dt">importance =</span> <span class="ot">TRUE</span>, <span class="dt">proximity =</span> <span class="ot">TRUE</span>, <span class="dt">na.action =</span> na.exclude)</span>
<span id="cb114-12"><a href="dataanalytic-critique.html#cb114-12" aria-hidden="true"></a></span>
<span id="cb114-13"><a href="dataanalytic-critique.html#cb114-13" aria-hidden="true"></a><span class="kw">names</span>(carb.mod)</span></code></pre></div>
<pre><code>##  [1] &quot;call&quot;            &quot;type&quot;            &quot;predicted&quot;       &quot;mse&quot;            
##  [5] &quot;rsq&quot;             &quot;oob.times&quot;       &quot;importance&quot;      &quot;importanceSD&quot;   
##  [9] &quot;localImportance&quot; &quot;proximity&quot;       &quot;ntree&quot;           &quot;mtry&quot;           
## [13] &quot;forest&quot;          &quot;coefs&quot;           &quot;y&quot;               &quot;test&quot;           
## [17] &quot;inbag&quot;           &quot;terms&quot;           &quot;na.action&quot;</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="dataanalytic-critique.html#cb116-1" aria-hidden="true"></a>carb.prox &lt;-<span class="st"> </span>carb.mod<span class="op">$</span>proximity</span>
<span id="cb116-2"><a href="dataanalytic-critique.html#cb116-2" aria-hidden="true"></a></span>
<span id="cb116-3"><a href="dataanalytic-critique.html#cb116-3" aria-hidden="true"></a><span class="co">#you can now explore carb.prox</span></span></code></pre></div>
<p>The final step in the analysis is to apply the model to the full dataset, in order to map the predicted outcomes.</p>
<div id="modelcrit-readings" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Resources this week</h3>
<ul>
<li><a href="http://r-statistics.co/Linear-Regression.html">Tutorial - Linear Regression</a></li>
</ul>
</div>
</div>
<div id="parameterizationvalidation-i" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Parameterization/Validation I</h2>
<!-- ## Parameterization/Validation II -->

<!-- # Data to Decisions -->
<!-- Geospatial imagery is an increasingly important type of information source for EDA applications. We consider any image data where earth/environment is captured on pixel arrays and used to better understand environmental phenomena. Such a broad approach to geospatial imagery captures tradtional sources such as earth-observation satellite-based sensors as well as non-traditional platforms such as smartphone cameras, RPS-based image sources, and handheld imaging platforms. Depending on how geospatial information is integrated into image data, there are different considerations for how you might integrated them within a project. We will review some common issues and techniques for handling a variety of image data sources in this chapter. -->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dataanalytic-visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="assignments.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["gg501.pdf", "gg501.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
